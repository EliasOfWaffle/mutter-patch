From 4f72099023bc5bb142a782a1924797729329cc9a Mon Sep 17 00:00:00 2001
From: Robert Mader <robert.mader@posteo.de>
Date: Wed, 6 Mar 2019 16:57:09 +0100
Subject: [PATCH] Revert "cogl: Pick glReadPixels format by target, not source"

This reverts commit 981b045459350d141fdfd16355cf2f4cd0aebc0f.

Fixes https://gitlab.gnome.org/GNOME/mutter/issues/418
---
 cogl/cogl/driver/gl/cogl-framebuffer-gl.c | 6 +-----
 1 file changed, 1 insertion(+), 5 deletions(-)

diff --git a/cogl/cogl/driver/gl/cogl-framebuffer-gl.c b/cogl/cogl/driver/gl/cogl-framebuffer-gl.c
index c2bf92882..84c2f314a 100644
--- a/cogl/cogl/driver/gl/cogl-framebuffer-gl.c
+++ b/cogl/cogl/driver/gl/cogl-framebuffer-gl.c
@@ -4,7 +4,6 @@
  * A Low Level GPU Graphics and Utilities API
  *
  * Copyright (C) 2007,2008,2009,2012 Intel Corporation.
- * Copyright (C) 2018 DisplayLink (UK) Ltd.
  *
  * Permission is hereby granted, free of charge, to any person
  * obtaining a copy of this software and associated documentation
@@ -1274,12 +1273,9 @@ _cogl_framebuffer_gl_read_pixels_into_bitmap (CoglFramebuffer *framebuffer,
   if (!cogl_is_offscreen (framebuffer))
     y = framebuffer_height - y - height;
 
-  /* Use target format ANY, because GL texture_swizzle extension cannot
-   * ever apply for glReadPixels.
-   */
   required_format = ctx->driver_vtable->pixel_format_to_gl_with_target (ctx,
+                                                                        framebuffer->internal_format,
                                                                         format,
-                                                                        COGL_PIXEL_FORMAT_ANY,
                                                                         &gl_intformat,
                                                                         &gl_format,
                                                                         &gl_type);
-- 
2.18.1

